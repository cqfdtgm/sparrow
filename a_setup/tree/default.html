## 0_setup/index.html
<%inherit file="base_tree.html" />

## ${parent.body()}

<%block name="js_onload">
<script type="text/javascript" src="tree.js"></script>
<script type="text/javascript">
    $(function(){
        $('#tr').tree({
            url: "tree?table=${that.table}" ,method: "get" ,checkbox:false ,lines:true
            ,dnd:false	//拖动太容易出错了，特别是在手机上。
            //  前端想禁止追加或拖动后突破下级数量限制，脚本过于复杂，统一通过后端判断后端返回值来处理。
            ,formatter: function(node) {
                return node.id + ': ' +  node.text + ' ' + node.state + ' ' + node.display;
            }
            ,loadFilter: treeFilter
            ,onSelect: treeSelect
            /*,onSelect: function(node) {
                if ('children' in node && 'total' in node && node.total>node.children.length) {
                    $('#pp').remove();
                    tree = this;
                    pp = $('<span id="pp" style="position:relative;top:-6px;right:0px;float:right;display:inline-block"></span>').appendTo(node.target);
                    pp.pagination({layout:['prev', 'links', 'next'], displayMsg:'', total:node.total
                        ,pageSize:node.pagesize, pageNumber: node.pageNumber
                        ,onSelectPage: function(pageNumber, pageSize) {
                            opts = $(tree).tree('options');
                            opts['queryParams']['page'] = pageNumber;
                            $(tree).tree('reload', node.target);
                            opts['queryParams']['page'] = undefined;
                            node.pageNumber = pageNumber;
                        }
                    });
                }
			},
            */,
			onExpand: function(node) {
			    $(this).tree('select', node.target);
			}
        });
        $('#dg').hide();
    });
</script>

<%block name="toolbutton">
   ## <div id="pp0" style="position:relative;display:inline-block;BBvisibility:hidden"></div>
</%block>
</%block>

